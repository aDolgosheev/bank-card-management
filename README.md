# Система Управления Банковскими Картами

Система управления банковскими картами на базе Spring Boot, предоставляющая REST API для создания, управления и просмотра данных о банковских картах, а также выполнения операций между картами пользователя.

## Функциональные возможности

### Администратор может:
- Создавать, блокировать, активировать и удалять карты
- Просматривать все карты
- Управлять пользователями

### Пользователь может:
- Просматривать свои карты (с параметризованным поиском и постраничной выдачей)
- Запрашивать блокировку карты
- Совершать переводы между своими картами, если у него есть несколько карт
- Просматривать баланс по своим картам

## Технический стек

- Java 17
- Spring Boot 3.2
- Spring Security с JWT аутентификацией
- Spring Data JPA (Hibernate)
- PostgreSQL
- Liquibase для миграций базы данных
- Swagger/OpenAPI для документации API
- Docker и Docker Compose для развертывания
- JUnit и Mockito для тестирования

## Требования к системе

- Java 17 или выше
- Maven
- Docker и Docker Compose (для запуска в контейнере)
- PostgreSQL (если запускаете без Docker)

## Запуск приложения

### Запуск с помощью Docker Compose

Самый простой способ запустить приложение - использовать Docker Compose:

1. Клонируйте репозиторий:
```
git clone https://github.com/dolgosheev/bank-card-management.git
cd bank-card-management
```

2. Запустите приложение с помощью Docker Compose:
```
docker-compose up -d
```

Приложение будет доступно по адресу: http://localhost:8080

### Запуск локально с помощью Maven

1. Убедитесь, что у вас установлена Java 17 и Maven
2. Клонируйте репозиторий:
```
git clone https://github.com/dolgosheev/bank-card-management.git
cd bank-card-management
```

3. Настройте подключение к PostgreSQL в файле `src/main/resources/application.properties`
4. Запустите приложение:
```
mvn spring-boot:run
```

## Документация API

После запуска приложения документация API доступна по адресу:
- Swagger UI: http://localhost:8080/swagger-ui.html
- OpenAPI JSON: http://localhost:8080/api-docs

## Аутентификация

Система использует JWT токены для аутентификации. Для получения токена необходимо отправить POST запрос на эндпоинт `/api/auth/signin` с данными пользователя.

### Демо-пользователи

В системе по умолчанию созданы два пользователя:

1. Администратор:
   - Email: admin@example.com
   - Пароль: admin123

2. Обычный пользователь:
   - Email: user@example.com
   - Пароль: user123

## Основные эндпоинты

### Аутентификация
- `POST /api/auth/signin` - Вход в систему и получение JWT токена
- `POST /api/auth/signup` - Регистрация нового пользователя

### Пользователи
- `GET /api/users` - Получение списка всех пользователей (только для администратора)
- `GET /api/users/{id}` - Получение информации о пользователе
- `DELETE /api/users/{id}` - Удаление пользователя (только для администратора)
- `GET /api/users/me` - Получение информации о текущем пользователе

### Карты
- `POST /api/cards` - Создание новой карты (только для администратора)
- `GET /api/cards` - Получение списка всех карт (только для администратора)
- `GET /api/cards/{id}` - Получение информации о карте
- `PATCH /api/cards/{id}/status` - Обновление статуса карты (только для администратора)
- `DELETE /api/cards/{id}` - Удаление карты (только для администратора)
- `GET /api/cards/user/{userId}` - Получение списка карт пользователя с пагинацией
- `GET /api/cards/user/{userId}/cards` - Получение всех карт пользователя
- `POST /api/cards/user/{userId}/card/{cardId}/block` - Запрос на блокировку карты
- `GET /api/cards/filter` - Фильтрация карт по различным параметрам

### Транзакции
- `POST /api/transactions` - Создание новой транзакции
- `GET /api/transactions` - Получение списка всех транзакций (только для администратора)
- `GET /api/transactions/{id}` - Получение информации о транзакции
- `GET /api/transactions/card/{cardId}` - Получение списка транзакций для карты
- `GET /api/transactions/user/{userId}/card/{cardId}` - Получение списка транзакций пользователя для конкретной карты

## Безопасность

- Данные карт хранятся в зашифрованном виде с использованием AES шифрования
- Номера карт маскируются при отображении (например: **** **** **** 1234)
- Пароли хранятся в хэшированном виде с использованием BCrypt
- Доступ к API защищен с использованием JWT токенов
- Доступ к конкретным операциям ограничен ролями пользователей

## Тестирование

Для запуска тестов выполните:
```
mvn test
``` 